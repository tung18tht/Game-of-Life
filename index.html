<!DOCTYPE html>

<html>

<head>
    <title>Conway's Game of Life</title>

    <style>
        body {
            background-color: black;
        }

        #topbar {
            display: grid;
            grid-template-columns: 30% 40% 30%;
        }

        #title {
            color: white;
            text-align: center;
            font-family: monospace;
            font-size: 30px;
        }

        #steps {
            color: white;
            text-align: right;
            font-family: monospace;
            font-size: 20px;
        }

        #universe {
            display: grid;
        }

        #universe div {
            border: 1px solid #222;
        }

        .live {
            background-color: white;
        }

        .dead {
            background-color: black;
        }
    </style>
</head>

<body>
    <div id="topbar">
        <div>
            <button onclick="run()">Run</button>
            <button onclick="pause()">Pause</button>
            <button onclick="step()">Step</button>
            <button onclick="random()">Random</button>
            <button onclick="reset()">Reset</button>
        </div>

        <div id="title">
            Conway's Game of Life
        </div>

        <div id="steps">
            Steps: 0
        </div>
    </div>

    <div id="universe" title="You can judge the cells destiny ... by clicking"></div>

    <script>
        let width = 70
        let height = 30
        let cellSize = 20
        let fps = 10

        let loopID = -1
        let universe = createEmptyUniverse()

        const UNIVERSE_DIV = document.getElementById("universe")
        UNIVERSE_DIV.style.gridTemplateColumns = "repeat(" + width + ", " + cellSize + "px)"

        const CELL_DIVS = createEmpty2DArray(width, height)

        for (let row= 0; row < height; row++) {
            for (let col = 0; col < width; col++) {
                const cellDiv = document.createElement("div")
                cellDiv.style.width = cellSize + "px"
                cellDiv.style.height = cellSize + "px"

                cellDiv.className = "dead"

                cellDiv.addEventListener("click", () => flip(row, col))

                UNIVERSE_DIV.appendChild(cellDiv)
                CELL_DIVS[row][col] = cellDiv
            }
        }


        function run() {
            if (loopID == -1) {
                loopID = setInterval(step, 1000 / fps)
            }
        }

        function pause() {
            if (loopID != -1) {
                clearInterval(loopID)
                loopID = -1
            }
        }

        function step() {
            const newUniverse = createEmptyUniverse()

            for (let row = 0; row < height; row++) {
                for (let col = 0; col < width; col++) {
                    const minRow = row > 1 ? row - 1 : 0
                    const minCol = col > 1 ? col - 1 : 0
                    const capRow = row < height - 2 ? row + 2 : height
                    const capCol = col < width - 2 ? col + 2 : width

                    let livingNeighbors = 0

                    for (let neighborRow = minRow; neighborRow < capRow; neighborRow++) {
                        for (let neighborCol = minCol; neighborCol < capCol; neighborCol++) {
                            if (neighborRow != row || neighborCol != col) {
                                livingNeighbors += universe[neighborRow][neighborCol] ? 1 : 0
                            }
                        }
                    }

                    if (livingNeighbors == 3 || (universe[row][col] && livingNeighbors == 2)) {
                        newUniverse[row][col] = true
                    }
                }
            }

            universe = newUniverse
            updateAllCellDivs()
        }

        function random() {
            if (loopID == -1) {
                universe = createEmptyUniverse()

                for (let row = 0; row < height; row++) {
                    for (let col = 0; col < width; col++) {
                        universe[row][col] = Math.random() < 0.5
                    }
                }

                updateAllCellDivs()
            }
        }

        function reset() {
            if (loopID == -1) {
                universe = createEmptyUniverse()
                updateAllCellDivs()
            }
        }

        function updateAllCellDivs() {
            for (let row= 0; row < height; row++) {
                for (let col = 0; col < width; col++) {
                    updateCellDiv(row, col)
                }
            }
        }

        function flip(row, col) {
            if (loopID == -1) {
                universe[row][col] = !universe[row][col]
                updateCellDiv(row, col)
            }
        }

        function updateCellDiv(row, col) {
            CELL_DIVS[row][col].className = universe[row][col] ? "live" : "dead"
        }

        function createEmptyUniverse() {
            const emptyUniverse = createEmpty2DArray(width, height)
            emptyUniverse.forEach(row => row.fill(false))

            return emptyUniverse
        }

        function createEmpty2DArray(width, height) {
            const emptyArray = new Array(height)
            for (let row = 0; row < height; row++) {
                emptyArray[row] = new Array(width)
            }

            return emptyArray
        }
    </script>
</body>

</html>
