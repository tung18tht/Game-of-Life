<!DOCTYPE html>

<html>

<head>
    <title>Conway's Game of Life</title>

    <style>
        body {
            background-color: black;
        }

        #topbar {
            margin: 5px;
            display: grid;
            grid-template-columns: 30% 40% 30%;
            min-height: 50px;
        }

        #title {
            margin: auto;
            color: white;
            text-align: center;
            font-family: monospace;
            font-size: 30px;
        }

        #steps {
            margin-top: auto;
            margin-bottom: auto;
            color: white;
            text-align: right;
            font-family: monospace;
            font-size: 20px;
        }

        #footer {
            margin: 5px;
            color: white;
            font-family: monospace;
            font-size: 15px;
        }

        #footer a {
            color: white;
            font-family: monospace;
            font-size: 15px;
            font-style: italic;
            text-decoration: none;
        }

        #footer a:hover {
            text-decoration: underline;
        }

        #universe {
            margin: 5px;
            display: grid;
        }

        #universe div {
            border: 1px solid #222;
        }

        .live {
            background-color: white;
        }

        .dead {
            background-color: black;
        }
    </style>
</head>

<body>
    <div id="topbar">
        <div>
            <button onclick="play()">Play</button>
            <button onclick="pause()">Pause</button>
            <button onclick="step()">Step</button>
            <button onclick="random()">Random</button>
            <button onclick="reset()">Reset</button>
        </div>

        <div id="title">
            Conway's Game of Life
        </div>

        <div id="steps">
            Steps: <span id="stepsNumber">0</span>
        </div>
    </div>

    <div id="universe" title="You can judge the cells destiny ... by clicking"></div>

    <div id="footer">Made by Tung Nguyen -
        <a href="https://github.com/tung18tht/Game-of-Life" target="_blank">Source code</a>
    </div>

    <script>
        let width = 70
        let height = 30
        let cellSize = 20
        let fps = 10

        let steps = 0
        let loopID = -1
        let universe = createEmptyUniverse()

        const UNIVERSE_DIV = document.getElementById("universe")
        UNIVERSE_DIV.style.gridTemplateColumns = "repeat(" + width + ", " + cellSize + "px)"

        const CELL_DIVS = createEmpty2DArray(width, height)

        for (let row= 0; row < height; row++) {
            for (let col = 0; col < width; col++) {
                const cellDiv = document.createElement("div")
                cellDiv.style.width = cellSize + "px"
                cellDiv.style.height = cellSize + "px"

                cellDiv.className = "dead"

                cellDiv.addEventListener("click", () => flip(row, col))

                UNIVERSE_DIV.appendChild(cellDiv)
                CELL_DIVS[row][col] = cellDiv
            }
        }

        const STEPS_NUMBER_SPAN = document.getElementById("stepsNumber")


        function play() {
            if (loopID == -1) {
                loopID = setInterval(step, 1000 / fps)
            }
        }

        function pause() {
            if (loopID != -1) {
                clearInterval(loopID)
                loopID = -1
            }
        }

        function step() {
            const newUniverse = createEmptyUniverse()

            for (let row = 0; row < height; row++) {
                for (let col = 0; col < width; col++) {
                    const minRow = row > 1 ? row - 1 : 0
                    const minCol = col > 1 ? col - 1 : 0
                    const capRow = row < height - 2 ? row + 2 : height
                    const capCol = col < width - 2 ? col + 2 : width

                    let livingNeighbors = 0

                    for (let neighborRow = minRow; neighborRow < capRow; neighborRow++) {
                        for (let neighborCol = minCol; neighborCol < capCol; neighborCol++) {
                            if (neighborRow != row || neighborCol != col) {
                                livingNeighbors += universe[neighborRow][neighborCol] ? 1 : 0
                            }
                        }
                    }

                    if (livingNeighbors == 3 || (universe[row][col] && livingNeighbors == 2)) {
                        newUniverse[row][col] = true
                    }
                }
            }

            universe = newUniverse
            updateAllCellDivs()
            updateStepsNumber(steps + 1)
        }

        function random() {
            pause()
            universe = createEmptyUniverse()

            for (let row = 0; row < height; row++) {
                for (let col = 0; col < width; col++) {
                    universe[row][col] = Math.random() < 0.5
                }
            }

            updateAllCellDivs()
            updateStepsNumber(0)
        }

        function reset() {
            pause()
            universe = createEmptyUniverse()
            updateAllCellDivs()
            updateStepsNumber(0)
        }

        function flip(row, col) {
            if (loopID == -1) {
                universe[row][col] = !universe[row][col]
                updateCellDiv(row, col)
                updateStepsNumber(0)
            }
        }

        function updateAllCellDivs() {
            for (let row= 0; row < height; row++) {
                for (let col = 0; col < width; col++) {
                    updateCellDiv(row, col)
                }
            }
        }

        function updateCellDiv(row, col) {
            CELL_DIVS[row][col].className = universe[row][col] ? "live" : "dead"
        }

        function updateStepsNumber(newSteps) {
            steps = newSteps
            STEPS_NUMBER_SPAN.innerHTML = steps
        }

        function createEmptyUniverse() {
            const emptyUniverse = createEmpty2DArray(width, height)
            emptyUniverse.forEach(row => row.fill(false))

            return emptyUniverse
        }

        function createEmpty2DArray(width, height) {
            const emptyArray = new Array(height)
            for (let row = 0; row < height; row++) {
                emptyArray[row] = new Array(width)
            }

            return emptyArray
        }
    </script>
</body>

</html>
